Todo - Fixes / Enhancements
===========================


[ ] Enhancement - markdown syntax for table.
[ ] Enhancement - ctr+; inserts current date.


[x] Remove titleDisplay attribute.
[x] Second edit in notes gets dropped.
[x] <br/> replace only when not preceeded by '>' this allows inline html on notes but does not put the <br/>
[x] Update todoInfo.done in Todo Dasboard does not get reflected back on the index page.
[x] Ensure all | date 'mediumDate'
[x] Reordering after updating todoInfo.done to true in Setup Editor. Getting TypeError: Cannot set property 'order' of undefined


Modal
=====
See: Creating A Simple Modal System In AngularJS http://www.bennadel.com/blog/2806-creating-a-simple-modal-system-in-angularjs.htm
     Github: https://github.com/bennadel/JavaScript-Demos/blob/master/demos/managing-modals-angularjs/

Confirmation dialogbox.
http://ethaizone.github.io/Bootstrap-Confirmation/#install


npm config set proxy http://proxy.company.com:8080
npm config set https-proxy http://proxy.company.com:8080


Data URLs
---------

See: THREE AMAZING USES FOR DATAURLS
    http://wolframhempel.com/2012/12/06/three-amazing-uses-for-dataurls/

// <img src=”data:image/png;base64,iVBOR…” />
function saveDataUrl( fileName, dataUrl )
{
    var dataString = dataUrl.split( "," )[ 1 ];
    var buffer = new Buffer( dataString, 'base64');
    var extension = dataUrl.match(/\/(.*)\;/)[ 1 ];
    var fs = require( "fs" );
    var fullFileName = fileName + "." + extension;
    fs.writeFileSync( fullFileName, buffer, "binary" );
}

Posting Data
------------
http://codepen.io/netsi1964/pen/IoJbg  - Html Paste Image to Page.
http://strd6.com/2011/09/html5-javascript-pasting-image-data-in-chrome/
https://github.com/vladmalik/pasteimage

<script>

	// See: https://github.com/vladmalik/pasteimage
	// 		https://groups.google.com/forum/#!msg/angular/kqFrwiysgpA/eB9mNbQzcHwJ
	function paste(imageData) {
		var e = document.getElementById('imageHolderPastTargetID');
		var scope = angular.element(e).scope();
		scope.$apply(function() {
			scope.updateImageData(imageData);
		});
	}

	$(function() {
		$.pasteimage(paste);
	});

</script>

<div ng-if="imageData.length > 0">
  <img ng-src="{{imageData}}" width="100em"/>
</div>

$scope.imageData = "";
$scope.updateImageData = function(data) {
  $scope.imageData = data;
  console.log("updateImageData called..." + data);
  var dataObj = {fileName:"firstImageFile",dataUrl:data};
  $http.post('/local/uploadimage', dataObj).
    then(function(response) {
      console.log("Post OK: " + JSON.stringify({data: response.data}) + " status: " + response.status);
    }, function(response) {
      console.log("Post FAIL: " + JSON.stringify({data: response.data}) +
      " status: " + response.status);
    });
};

File Action Rollback Management
-------------------------------
Applies for when pasting and attaching image files to reference items.

Scenarios:
T1: item.add, image.add, item.cancel
T2: item.add (1 or more times), refsection.cancel.


Environment - production versus develoment.
-------------------------------------------
app.get('env') === 'development')  reads NODE_ENV="development"
This can be set in the enviroment tab of the nssm (non-sucking service manager) tool - see https://nssm.cc/usage

Update ID attribute
-------------------
Need to change the target attribute the paste image.
https://docs.angularjs.org/guide/directive#-ngattr-attribute-bindings
http://stackoverflow.com/questions/23655009/how-to-set-the-id-attribute-of-a-html-element-dynamically-with-angular-js

Knowm Issue
-----------
Cached Image Issue - If you delete an image from an item, where this causes the image file to be removed on the server
side, and you leave the image tag in the note text then the image will still appear after saving. This occurs because
the image is still in the browser image cache.

Spidermonkey
------------
Node.js is not a nice shell for testing out fragments of javascript. Downloaded pre-build latest version of
spidermonkey from http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/latest-trunk/

Design Principles
-----------------
Keep the json data store as small as possible - be efficient with the data that is stored.
- Don't store images in the json data.
- Store optional elements only when needed and allow the logic work it out, e.g. section.item.todo


Todo Feature Design
===================

Data Structure
--------------

 "linkItems":[
		{"title":"[ ] Health Check stored links","order":1, "hasTodo":true,
       todoInfo:{"done":false, "due":"2015-09-08T09:03:04.653Z","startby":"2015-09-08T09:03:04.653Z"}
		},
		{"title":"[ ] Chrome plug-in","order":2, "todo":false},

 Journey
 ---
 1. Creating, the user click the checkbox to make the linkitem a todo item.
    Removing, user untick the checkbox - give a warning maybe?

	Optional fields for todo: are due-date and startby. These can normally be the same but if a pre-warning
	is required the startby can be specified.

 2. Updating the todo status:

		In the editor - status can be updated in the Todo Tab.
		Or, direct edit - user just clicks a done checkbox and the order recalculated to be: item.done.highest.order -1

 3. Styling - completed todos will have a strike-through. Over-due will be coloured red / danger. Todo progressed to
	startby will be coloured orange / warning.

 4. Alerting - onload / or at a scheduled time a.

	i. 	a notification will be posted with a summary of started and over due items.
	ii.	a new screen will be used to list the current to items.


String Dates to Date
====================

See Regex Solution http://aboutcode.net/2013/07/27/json-date-parsing-angularjs.html - Good approach works by regex for date string format.
The Rexex Solution provides the solution.
Cloning of objects using JSON.parse(JSON.stringify(newItem)) is used through out the code for edit change detection but this approach resets
the dates to string dates.

Solution design:

    angular.module('app').config(["$httpProvider", function ($httpProvider) {
         $httpProvider.defaults.transformResponse.push(function(responseData){
            convertDateStringsToDates(responseData);
            return responseData;
        });
    }]);


    function cloneObject(o) {
      var clone = JSON.parse(JSON.stringify(newItem));
      convertDateStringsToDates(clone);
      return clone;
    }

    Considered using the angular.copy but this clears out the $$haskkey field which then distorts the edit change detection.

    Do code inspection where the following fields are used:

    createDate - used on RefSection
    startBy - todoInfo
    due - todoInfo
    date - milestones.


JSON Schema
===========
http://som-research.uoc.edu/tools/jsonDiscoverer/#/   worked!
