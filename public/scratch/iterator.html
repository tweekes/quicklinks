<html>
<head>

</head>

<body>

<script>

    function Iterators() {
        this.data =
                [
                    {"dtype":"ref-section","sectionType":"Horz","sectionOrder":3,"createDate":"2015-08-06T19:20:20.242Z","key":"topAdmin","title":"Top Admin","comment":"This is top level general purpose menu.","jumpItems":[{"title":"Breeze V2","link":"https://slf.adobeconnect.com/TomWeekes","note":"V2","titleDisplay":"Breeze V2*"},{"title":"TMS","link":"http://sv4002.ie.sunlife/TMSDOTNET/DEFAULT.ASPX","note":"I am just adding a new note. \nThe first note would you believe.","titleDisplay":"TMS*"},{"title":"Webtime","link":"http://usnotime.ca.sunlife/webtime/Logon.asp","note":"","titleDisplay":"Webtime"},{"title":"New Title","link":"http://www.google.ie","titleDisplay":"New Title"},{"title":"last","link":"last","note":"last 1","titleDisplay":"last*"}],"linkItems":[],"_id":"5Oqhjgnwf2oeLqUC"},
                    {"dtype":"ref-section","sectionType":"Horz","sectionOrder":1,"createDate":"2015-08-09T19:20:20.242Z","jumpItems":[{"title":"SP Prj","link":"http://sp.sunlifecorp.com/sites/USPM/USProjectManagment/ePay 2015- 1166/"},{"title":"SP Arch","link":"http://sp.sunlifecorp.com/sites/USArch/USArchitecture/Forms/AllItems.aspx?RootFolder=%2Fsites%2FUSArch%2FUSArchitecture%2FProjects%2FEPay&FolderCTID=0x012000F44814D418C97845A82F71C95AD813B3&View={909A216F-F4AF-42AB-88DB-0B326E16039F}","note":""},{"title":"JIRA","link":"http://jiraus.sunlifecorp.com/browse/AGP-379"}],"linkItems":[{"title":"Project Milestones.","note":"<wtmilestones start=\"01/01/15\" tdgrb=\"22/04/15\" asgp=\"20/04/15\" alc=\"15/05/15\" etrb=\"25/05/15\" release=\"01/11/15\"></wtmilestones>"}],"title":"EPay","key":"epay","comment":"Project EPay","_id":"GSf5MyTFL95Gmo7j"},
                    {"dtype":"ref-section","sectionType":"Vert","sectionOrder":5,"createDate":"2015-08-10T13:42:55.498Z","jumpItems":[],"linkItems":[{"title":"EOI Admin","link":"http://wiki.sunlifecorp.com/pages/viewpageattachments.action?pageId=15335437&highlight=EOI+Admin+Context+Diagram.jpg#EOI+Admin-attachment-EOI+Admin+Context+Diagram.jpg"}],"title":"Prod Support","key":"prodSupport","comment":"Relevant links and pages from the production support team","_id":"KGlfEXqtzocrZ5TL"},
                    {"dtype":"ref-section","sectionType":"Vert","sectionOrder":1,"createDate":"2015-08-04T20:02:45.780Z","jumpItems":[{"title":"one","link":"http://www.one.com","titleDisplay":"one"},{"note":"This is just a note.","title":"three","titleDisplay":"three*"}],"linkItems":[],"title":"My First","key":"myFirst","comment":"This is first throigh the editor.","_id":"MZbNxcfUVeVXfcmp"},
                    {"dtype":"ref-section","sectionType":"Horz","createDate":"2015-08-03T20:02:45.780Z","key":"topArchitecture","title":"Top Architecture","comment":"This is the top, non project specific, application architecture menu.","jumpItems":[{"title":"Wiki D & Arch","link":"\"http://wiki.sunlifecorp.com/pages/viewpage.action?pageId=81511594","note":""},{"title":"Arch Lib","link":"http://archlib.ca.sunlife/archlibrary/","note":""},{"title":"TDGRB","link":"http://wiki.sunlifecorp.com/display/UARC/TDG+Review+Board#","note":"TDG Review Board Submission Request link is positioned down the right hand side of the web page."}],"linkItems":[],"_id":"NrUciN7aegnGl7QJ"},
                    {"dtype":"ref-section","sectionType":"Vert","sectionOrder":2,"createDate":"2015-08-11T20:02:45.780Z","key":"partnerSites","title":"Partner Sites","comment":"Menu to hold partner sites.","jumpItems":[{"title":"Celent","link":"http://www.celent.com","note":"Password is {occam}1"}],"linkItems":[],"_id":"VxGPemrKAnmqD8pr"},
                    {"dtype":"ref-section","sectionType":"Vert","sectionOrder":4,"createDate":"2015-08-02T20:02:45.780Z","key":"topGoals","title":"Top Goals","comment":"A section containing the top goals.","jumpItems":[],"linkItems":[{"title":"A goal with note only","link":"","note":"This is a note","titleDisplay":"A goal with note only*"},{"title":"A goal with note and a link","link":"http://www.google.com/","note":"This is the note to go with the link.","titleDisplay":"A goal with note and a link*"},{"title":"Goal A","note":"A","titleDisplay":"Goal A*"},{"title":"Goal B","titleDisplay":"Goal B"},{"title":"Goal D","titleDisplay":"Goal D"},{"title":"Goal E","titleDisplay":"Goal E"},{"title":"Goal F","titleDisplay":"Goal F"},{"title":"Goal G","titleDisplay":"Goal G"},{"title":"Goal H","titleDisplay":"Goal H"},{"title":"Goal I","titleDisplay":"Goal I"},{"title":"Goal J","titleDisplay":"Goal J"},{"title":"Goal H","titleDisplay":"Goal H"},{"title":"Goal K"},{"title":"Goal L"}],"_id":"X3wzD3gMz4K7mZPZ"},
                    {"dtype":"ref-section","sectionType":"Horz","createDate":"2015-08-01T20:02:45.780Z","key":"consoles","title":"Developer Consoles","comment":"Menu for development consoles like, weblogic, websphere, etc","jumpItems":[{"title":"Weblogic (Dev)","link":"http://new-dev-centraladmin.us.sunlife:1700/console","note":"FINEOS apps, CDA, etc,"},{"title":"Websphere(Dev)","link":"https://dev-xpressionadmin.us.sunlife:11001/ibm/console/login.do?action=secure","note":""},{"title":"Websphere(Qar)","link":"https://qar-xpressionadmin.us.sunlife:11001/ibm/console/login.do?action=secure","note":""}],"linkItems":[],"_id":"jhMreVZytC8nf5ea"},
                    {"dtype":"ref-section","sectionType":"Vert","createDate":"2015-08-03T12:20:54.334Z","jumpItems":[],"linkItems":[{"title":"EOI Admin","link":"http://wiki.sunlifecorp.com/display/TechnologyServices/EOI+Administration+Application+Page","titleDisplay":"EOI Admin"},{"link":"http://wiki.sunlifecorp.com/pages/viewpageattachments.action?pageId=70680674&highlight=Retained+Asset+Input+Screen.doc.zip#RAA-attachment-Retained+Asset+Input+Screen.doc.zip","title":"RAA (Mellon)","note":"A Zip containing key documents on the Retained Assets Application.","titleDisplay":"RAA (Mellon)*"}],"title":"Development Wiki","key":"developmentWiki","comment":"References into the Development Wiki","_id":"mKLYdpQAISoK1Awh"},
                    {"dtype":"ref-section","sectionType":"Vert","sectionOrder":3,"createDate":"2015-06-04T20:02:45.780Z","key":"topAdmin","title":"Top Admin","comment":"This is top level general purpose menu.","jumpItems":[{"title":"Breeze V2","link":"https://slf.adobeconnect.com/TomWeekes","note":"V2","titleDisplay":"Breeze V2*"},{"title":"TMS","link":"http://sv4002.ie.sunlife/TMSDOTNET/DEFAULT.ASPX","note":"I am just adding a new note. \nThe first note would you believe.","titleDisplay":"TMS*"},{"title":"Webtime","link":"http://usnotime.ca.sunlife/webtime/Logon.asp","note":"","titleDisplay":"Webtime"},{"title":"New Title","link":"http://www.google.ie","titleDisplay":"New Title"},{"title":"last","link":"last","note":"last 1","titleDisplay":"last*"}],"linkItems":[],"_id":"5Oqhjgnwf2oeLqUC"}
                ];

        this.compare = function (x,y) {
            if(x.hasOwnProperty("sectionOrder") && y.hasOwnProperty("sectionOrder")) {
                if (x.sectionOrder === y.sectionOrder) {
                    return x.createDate.localeCompare(y.createDate)
                } else {
                    return x.sectionOrder - y.sectionOrder;
                }
            } else {
                if (x.hasOwnProperty("sectionOrder")) {
                    return -1;
                }
                if (y.hasOwnProperty("sectionOrder")) {
                    return 1;
                }
                return x.createDate.localeCompare(y.createDate)
            }

            // For reference:  "B".localeCompare("A")  returns: 1  "A".localeCompare("B") returns -1
        };

        this.sectionsHorizontal = function() {
            return this.data.filter(function (e) {
                return e.sectionType === "Horz";
            }).sort(this.compare);
        };

        this.sectionsVertical = function() {
            return this.data.filter(function (e) {
                return e.sectionType === "Vert";
            }).sort(this.compare);
        };

        this.assignNumber = function(sectionType, key, sectionOrder ) {
            var r = this.data.filter(function (e) {
                return e.sectionType === sectionType && e.hasOwnProperty("sectionOrder");
            }).sort(this.compare);

            //               c                n(1)
            // Scenario: { (A,1) (B,2) (C,3) (D,4) (E,5) } ==> { (D,1) (A,2) (B,3) (C,4) (E,5) }

            //                                n(5)  c
            // Scenario: { (A,1) (B,2) (C,3) (D,4) (E,5) } ==> { (A,1) (B,2) (C,3) (E,4) (D,5) }

            /*
                promoting - new order < current order
                All element from current holder to element before new holder must be demoted

                seek to ch.
                        for each before n-target: order++
                n-target.order = n.order,
                Remaining unchanged.
                sort again

                demoting - new order > current order

                All elements after the current holder with order <= n.order must be promoted.

                seek to n target
                n-target.order = n.order
                for each after n-target and e.order <= n.order
                  e.order--

            */



            var currentHolderFound = false;
            var newHolderFound = false;
            var newHolderSectionOrder = null;
            for (j in r) {
                if(r[j].sectionOrder === sectionOrder) {
                    currentHolderFound = true;
                }

                if (r[j].key === key) {
                    newHolderFound = true;
                    newHolderSectionOrder = r[j].sectionOrder;
                    r[j].sectionOrder = sectionOrder;
                }

                if (currentHolderFound && !newHolderFound) {
                    r[j].sectionOrder++;
                }
            }
            return r.sort(this.compare);
        };


        // refSection ::= the refSection to have the sequence applied.
        // key ::= identifies the section being assigned the order number.
        // newSectionOrder ::= section order.
        this.assignSectionOrder = function(refSection, newSectionOrder ) {
            // Does the refSection.sectionOrder exist?
            if (!refSection.hasOwnProperty("sectionOrder")) {
                refSection.sectionOrder = 99999;
            }

            // Do a refSection already exist with the newSectionOrder
              // ...

            var r = this.data.filter(function (e) {
                return e.sectionType === sectionType && e.hasOwnProperty("sectionOrder");
            }).sort(this.compare);

            // Determine promote (--) or demote (++) mode.
            var mode = "NoChange";
            for (j in r) {
                if (r[j].key === key) {
                  mode = (newSectionOrder < r[j].sectionOrder ) ? "Promote" : "Demote";
                  break;
                }
            }

            /*
                promoting - new order < current order
                All element from current holder to element before new holder must be demoted

                seek to ch.
                        for each before n-target: order++
                n-target.order = n.order,
                Remaining unchanged.
                sort again

            */

            if (mode === "Promote") {

            } else if (mode === "Demote") {

            } else if (mode === "NoChange") {
              // Do nothing mode is NoChange
            }
        }

        this.display = function(a) {
            for (var i in a) {
                console.log(a[i].key + " " + a[i].sectionType + " " + a[i].createDate + " " + a[i].sectionOrder);
            }
        };
    }

    var i = new Iterators();
    i.display(i.sectionsHorizontal());
    console.log(" ");
    i.display(i.sectionsVertical());
    console.log(" ");
    i.display(i.assignNumber("Vert","topGoals",5));

    /*    epay Horz 2015-08-09T19:20:20.242Z 1
         topAdmin Horz 2015-08-06T19:20:20.242Z 3
         consoles Horz 2015-08-01T20:02:45.780Z undefined
         topArchitecture Horz 2015-08-03T20:02:45.780Z undefined

         myFirst Vert 2015-08-04T20:02:45.780Z 1
         partnerSites Vert 2015-08-11T20:02:45.780Z 2
         topAdmin Vert 2015-06-04T20:02:45.780Z 3
         topGoals Vert 2015-08-02T20:02:45.780Z 3
         prodSupport Vert 2015-08-10T13:42:55.498Z 3
         developmentWiki Vert 2015-08-03T12:20:54.334Z undefined

         myFirst Vert 2015-08-04T20:02:45.780Z 1
         partnerSites Vert 2015-08-11T20:02:45.780Z 2
         topAdmin Vert 2015-06-04T20:02:45.780Z 3
         topGoals Vert 2015-08-02T20:02:45.780Z 4
         prodSupport Vert 2015-08-10T13:42:55.498Z 5

                 myFirst Vert 2015-08-04T20:02:45.780Z 1
                 partnerSites Vert 2015-08-11T20:02:45.780Z 2
                 topAdmin Vert 2015-06-04T20:02:45.780Z 3
                 topGoals Vert 2015-08-02T20:02:45.780Z 5
                 prodSupport Vert 2015-08-10T13:42:55.498Z 5



    */


</script>

div.x>div.y>div#100

</body>

</html>
